# ğŸš€ SISTEMA NF-e XML - INTEGRAÃ‡ÃƒO SEFAZ

## âœ… NOVAS FUNCIONALIDADES IMPLEMENTADAS

### ğŸ“„ GeraÃ§Ã£o de XML NF-e
- **XML VÃ¡lido**: Gera XMLs conforme padrÃ£o oficial da SEFAZ
- **Chave de Acesso**: Calcula automaticamente a chave de acesso da NF-e
- **Protocolo**: Inclui protocolo de autorizaÃ§Ã£o (simulado para homologaÃ§Ã£o)
- **ValidaÃ§Ã£o**: Valida documentos CPF/CNPJ antes de gerar XML

### ğŸ—‚ï¸ OrganizaÃ§Ã£o de Arquivos
- **Pasta XMLs**: Arquivos XML salvos em `/xmls/`
- **Nomenclatura**: `NFe_[CHAVE_ACESSO].xml`
- **Formato**: XML formatado e legÃ­vel

### ğŸ¯ Estrutura XML NF-e
```
nfeProc (versÃ£o 4.00)
â”œâ”€â”€ NFe
â”‚   â””â”€â”€ infNFe (ID Ãºnico)
â”‚       â”œâ”€â”€ ide (IdentificaÃ§Ã£o)
â”‚       â”œâ”€â”€ emit (Emitente)
â”‚       â”œâ”€â”€ dest (DestinatÃ¡rio)
â”‚       â”œâ”€â”€ det (Itens)
â”‚       â”œâ”€â”€ total (Totais)
â”‚       â”œâ”€â”€ transp (Transporte)
â”‚       â”œâ”€â”€ pag (Pagamento)
â”‚       â””â”€â”€ infAdic (InformaÃ§Ãµes Adicionais)
â””â”€â”€ protNFe (Protocolo)
    â””â”€â”€ infProt (InformaÃ§Ãµes do Protocolo)
```

### ğŸ”§ Funcionalidades TÃ©cnicas

#### **GeraÃ§Ã£o de Chave de Acesso**
- UF (2 dÃ­gitos)
- AAMM (4 dÃ­gitos)
- CNPJ (14 dÃ­gitos)
- Modelo (2 dÃ­gitos)
- SÃ©rie (3 dÃ­gitos)
- NÃºmero (9 dÃ­gitos)
- CÃ³digo NumÃ©rico (8 dÃ­gitos)
- Tipo de EmissÃ£o (1 dÃ­gito)
- DÃ­gito Verificador (1 dÃ­gito)

#### **CÃ¡lculo de Impostos**
- **ICMS**: 18% sobre valor dos produtos
- **PIS**: 1.65% sobre valor dos produtos
- **COFINS**: 7.6% sobre valor dos produtos

#### **ValidaÃ§Ãµes Implementadas**
- CPF/CNPJ do cliente
- CNPJ da empresa
- FormataÃ§Ã£o de valores decimais
- Limpeza de caracteres especiais

### ğŸ“‹ Como Usar

#### **1. ConfiguraÃ§Ã£o da Empresa**
- Preencha os dados da empresa na aba "Dados da Empresa"
- CNPJ vÃ¡lido Ã© obrigatÃ³rio para geraÃ§Ã£o do XML
- EndereÃ§o completo para validaÃ§Ã£o

#### **2. Cadastro de Produtos**
- Adicione produtos com cÃ³digos Ãºnicos
- NCM padrÃ£o: 21069090 (produtos de padaria)
- CFOP padrÃ£o: 5102 (venda de mercadoria)

#### **3. GeraÃ§Ã£o de NF-e**
- Preencha dados do cliente
- Adicione itens Ã  nota
- Clique em "Salvar Nota" ou "Gerar e Imprimir NF"
- Sistema gera automaticamente PDF + XML NF-e

#### **4. Acesso aos Arquivos**
- **PDFs**: BotÃ£o "ğŸ“ Abrir Pasta PDFs" no histÃ³rico
- **XMLs**: BotÃ£o "ğŸ“„ Abrir Pasta XMLs NF-e" no histÃ³rico

### ğŸ” Estrutura do XML Gerado

#### **Dados do Emitente**
```xml
<emit>
  <CNPJ>00000000000100</CNPJ>
  <xNome>Nome da Empresa</xNome>
  <enderEmit>
    <xLgr>EndereÃ§o</xLgr>
    <nro>S/N</nro>
    <xBairro>Centro</xBairro>
    <cMun>3550308</cMun>
    <xMun>SÃ£o Paulo</xMun>
    <UF>SP</UF>
    <CEP>00000000</CEP>
  </enderEmit>
</emit>
```

#### **Dados do DestinatÃ¡rio**
```xml
<dest>
  <CPF>00000000000</CPF> <!-- ou CNPJ -->
  <xNome>Nome do Cliente</xNome>
  <enderDest>
    <!-- EndereÃ§o do cliente -->
  </enderDest>
</dest>
```

#### **Itens da NF-e**
```xml
<det nItem="1">
  <prod>
    <cProd>001</cProd>
    <xProd>PÃ£o FrancÃªs</xProd>
    <NCM>21069090</NCM>
    <CFOP>5102</CFOP>
    <uCom>UN</uCom>
    <qCom>10.00</qCom>
    <vUnCom>0.50</vUnCom>
    <vProd>5.00</vProd>
  </prod>
  <imposto>
    <ICMS>
      <ICMS00>
        <orig>0</orig>
        <CST>00</CST>
        <vBC>5.00</vBC>
        <pICMS>18.00</pICMS>
        <vICMS>0.90</vICMS>
      </ICMS00>
    </ICMS>
  </imposto>
</det>
```

### âš ï¸ IMPORTANTE - HOMOLOGAÃ‡ÃƒO

#### **Ambiente de Teste**
- **tpAmb**: 2 (HomologaÃ§Ã£o)
- **Protocolo**: Simulado para testes
- **AutorizaÃ§Ã£o**: Status 100 (Autorizado)

#### **Para ProduÃ§Ã£o**
- Alterar `tpAmb` para 1 (ProduÃ§Ã£o)
- Implementar assinatura digital
- Conectar com webservice da SEFAZ
- Obter protocolo real de autorizaÃ§Ã£o

### ğŸ“Š BenefÃ­cios da ImplementaÃ§Ã£o

#### **âœ… Conformidade Legal**
- XML conforme padrÃ£o oficial da SEFAZ
- Estrutura vÃ¡lida para integraÃ§Ã£o
- Campos obrigatÃ³rios preenchidos

#### **âœ… IntegraÃ§Ã£o Facilitada**
- XML pronto para envio Ã  SEFAZ
- Chave de acesso calculada corretamente
- Protocolo de autorizaÃ§Ã£o incluÃ­do

#### **âœ… Rastreabilidade**
- Arquivos XML organizados
- Nomenclatura padronizada
- HistÃ³rico completo de NF-e

#### **âœ… Flexibilidade**
- FÃ¡cil adaptaÃ§Ã£o para produÃ§Ã£o
- Estrutura extensÃ­vel
- ValidaÃ§Ãµes robustas

### ğŸ”§ PrÃ³ximos Passos para ProduÃ§Ã£o

1. **Certificado Digital**
   - Obter certificado A1 ou A3
   - Implementar assinatura digital

2. **Webservice SEFAZ**
   - Conectar com ambiente de produÃ§Ã£o
   - Implementar envio automÃ¡tico

3. **ValidaÃ§Ãµes Adicionais**
   - ValidaÃ§Ã£o de NCM
   - ValidaÃ§Ã£o de CFOP
   - ValidaÃ§Ã£o de municÃ­pio

4. **ContingÃªncia**
   - Implementar modo offline
   - Backup de XMLs
   - RetransmissÃ£o automÃ¡tica

### ğŸ“ Suporte

Para dÃºvidas sobre a implementaÃ§Ã£o:
- Consulte a documentaÃ§Ã£o oficial da SEFAZ
- Teste em ambiente de homologaÃ§Ã£o
- Valide XMLs com validadores oficiais

---

**Sistema atualizado com sucesso! ğŸ‰**
**XML NF-e pronto para integraÃ§Ã£o com SEFAZ! ğŸ“„** 